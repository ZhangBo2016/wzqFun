<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>jquery五子棋游戏 -</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <script type="text/javascript" src="js/CookieHandle.js"></script>
    <script type="text/javascript" src="js/jquery-1.7.2.js"></script>
</head>
<body>
<div class="wrapper">
    <div class="chessboard">
        <!-- top line -->
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top"></div>
        <div class="chess-top chess-right"></div>
        <!-- line 1 -->

        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 2 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 3 -->

        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 4 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 5 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 6 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 7 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 8 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 9 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 10 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 11 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 12 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- line 13 -->
        <div class="chess-left"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-middle"></div>
        <div class="chess-right"></div>
        <!-- bottom line  -->
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom"></div>
        <div class="chess-bottom chess-right"></div>
    </div>

    <div class="operating-panel">
        <p>
            <a id="black_btn" class="btn selected" href="#">黑&nbsp;&nbsp;子</a>
            <a id="white_btn" class="btn" href="#">白&nbsp;&nbsp;子</a>
        </p>
        <p>
            <a id="first_move_btn" class="btn selected" href="#">先&nbsp;&nbsp;手</a>
            <a id="second_move_btn" class="btn" href="#">后&nbsp;&nbsp;手</a>
        </p>
        <a id="replay_btn" class="btn" href="#">开&nbsp;&nbsp;&nbsp;始</a>
        <p id="result_info">胜率：100%</p>
        <p id="result_tips"></p>
    </div>

    <div style="display: none">
        <!-- 图片需合并 减少http请求数 -->
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/black.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/white.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up_left.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up_right.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_left.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_right.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down_left.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down_right.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/black_last.png" alt="preload"/>
        <img src="http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/white_last.png" alt="preload"/>
    </div>
</div>
</body>
</html>

<style>
    .wrapper {
        width: 600px;
        position: relative;
    }

/* 棋盘 */
div.chessboard {
    margin: 30px 0 0 50px;
    width: 542px;
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/chessboard.png) no-repeat 14px 14px rgb(250, 250, 250);
    overflow: hidden;
    box-shadow: 2px 2px 8px #888;
    -webkit-box-shadow: 2px 2px 8px #888;
    -moz-box-shadow: 2px 2px 8px #888;
}

div.chessboard div {
    float: left;
    width: 36px;
    height: 36px;
    border-top: 0px solid #ccc;
    border-left: 0px solid #ccc;
    border-right: 0;
    border-bottom: 0;
    cursor: pointer;
}

/* 棋子 */
div.chessboard div.black {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/black.png) no-repeat 4px 4px;
}

div.chessboard div.white {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/white.png) no-repeat 4px 4px;
}

div.chessboard div.hover {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover.png) no-repeat 1px 1px;
}

div.chessboard div.hover-up {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up.png) no-repeat 1px 1px;
}

div.chessboard div.hover-down {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down.png) no-repeat 1px 1px;
}

div.chessboard div.hover-up-left {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up_left.png) no-repeat 1px 1px;
}

div.chessboard div.hover-up-right {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_up_right.png) no-repeat 1px 1px;
}

div.chessboard div.hover-left {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_left.png) no-repeat 1px 1px;
}

div.chessboard div.hover-right {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_right.png) no-repeat 1px 1px;
}

div.chessboard div.hover-down-left {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down_left.png) no-repeat 1px 1px;
}

div.chessboard div.hover-down-right {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/hover_down_right.png) no-repeat 1px 1px;
}

div.chessboard div.white-last {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/white_last.png) no-repeat 4px 4px;
}

div.chessboard div.black-last {
    background: url(http://sandbox.runjs.cn/uploads/rs/102/r2dy3tyw/black_last.png) no-repeat 4px 4px;
}

/* 右侧 */

div.operating-panel {
    position: absolute;
    left: 610px;
    top: 150px;
    width: 200px;
    text-align: center;
}

.operating-panel a {
    display: inline-block;
    padding: 10px 15px;
    margin-bottom: 39px;
    margin-right: 8px;
    margin-left: 8px;
    background: rgb(100, 167, 233);
    text-decoration: none;
    color: #333;
    font-weight: bold;
    font-size: 16px;
    font-family: "微软雅黑", "宋体";
}

.operating-panel a:hover {
    background: rgb(48, 148, 247);
    text-decoration: none;
}

.operating-panel a.disable, .operating-panel a.disable:hover {
    cursor: default;
    background: rgb(197, 203, 209);
    color: rgb(130, 139, 148);
}

.operating-panel a.selected {
    border: 5px solid #F3C242;
    padding: 5px 10px;
}

#result_tips {
    color: #CE4242;
    font-size: 26px;
    font-family: "微软雅黑";
}

#result_info {
    margin-bottom: 26px;
}</style>

<script>
    $(document).ready(function() {
        fiveChess.init();
    });
    
    var fiveChess = (function () {
        var NO_CHESS = 0,
            BLACK_CHESS = -1,
            WHITE_CHESS = 1,
            chessArr = [],	//记录棋子
            isPlayWithAI= false,
            chessBoardHtml = "",
            LEFT = "black",
            RIGHT = "white"
            humanPlayer = LEFT,	//玩家棋子颜色
            AIPlayer = RIGHT,	//AI棋子颜色
            isPlayerTurn = true, //轮到player下棋
            totalGames = cookieHandle.getCookie("totalGames") || 0,	//总局数
            winGames = cookieHandle.getCookie("winGames") || 0,	//玩家赢局数
            isGameStart = false,	//游戏已经开始
            isGameOver = false, //游戏结束
            playerLastChess = [], //玩家最后下子位置
            AILastChess = []//AI最后下子位置
        
        //重置棋盘
        var resetChessBoard = function () {
            $("div.chessboard").html(chessBoardHtml);
            $("#result_tips").html("");
            isGameOver = false;
            isPlayerTurn = $("#first_move_btn").hasClass("selected");
            //初始化棋子状态
            var i, j;
            for (i = 0; i < 15; i++) {
                chessArr[i] = [];
                for (j = 0; j < 15; j++) {
                    chessArr[i][j] = NO_CHESS;
                }
            }
            //player下棋事件
            $("div.chessboard div").click(function () {
                if (isPlayWithAI && (!isPlayerTurn || isGameOver)) {
                    return;
                }else if(!isPlayWithAI && isGameOver){
                    isPlayerTurn = !isPlayerTurn
                }
                if (!isGameStart) {
                    gameStart();
                }
                var index = $(this).index(),
                    i = index / 15 | 0,
                    j = index % 15;
                if (chessArr[i][j] === NO_CHESS) {
                    playChess(i, j, humanPlayer);

                    if (i === 0 && j === 0) {
                        $(this).removeClass("hover-up-left");
                    }
                    else if (i === 0 && j === 14) {
                        $(this).removeClass("hover-up-right");
                    }
                    else if (i === 14 && j === 0) {
                        $(this).removeClass("hover-down-left");
                    }
                    else if (i === 14 && j === 14) {
                        $(this).removeClass("hover-down-right");
                    }
                    else if (i === 0) {
                        $(this).removeClass("hover-up");
                    }
                    else if (i === 14) {
                        $(this).removeClass("hover-down");
                    }
                    else if (j === 0) {
                        $(this).removeClass("hover-left");
                    }
                    else if (j === 14) {
                        $(this).removeClass("hover-right");
                    }
                    else {
                        $(this).removeClass("hover");
                    }
                    playerLastChess = [i, j];
                    playerWinOrNot(i, j);
                    //可通过【中介者模式】统一管理 人机或人人对战 业务代码
                    if(!isPlayWithAI)  humanPlayer == LEFT? humanPlayer = RIGHT : humanPlayer = LEFT;
                }
            });
            //鼠标在棋盘上移动效果
            $("div.chessboard div").hover(
                function () {
                    if (!isPlayerTurn || isGameOver) { return; }
                    var index = $(this).index(),
                        i = index / 15 | 0,
                        j = index % 15;
                    if (chessArr[i][j] === NO_CHESS) {
                        if (i === 0 && j === 0) {
                            $(this).addClass("hover-up-left");
                        }
                        else if (i === 0 && j === 14) {
                            $(this).addClass("hover-up-right");
                        }
                        else if (i === 14 && j === 0) {
                            $(this).addClass("hover-down-left");
                        }
                        else if (i === 14 && j === 14) {
                            $(this).addClass("hover-down-right");
                        }
                        else if (i === 0) {
                            $(this).addClass("hover-up");
                        }
                        else if (i === 14) {
                            $(this).addClass("hover-down");
                        }
                        else if (j === 0) {
                            $(this).addClass("hover-left");
                        }
                        else if (j === 14) {
                            $(this).addClass("hover-right");
                        }
                        else {
                            $(this).addClass("hover");
                        }
                    }
                },
                function () {
                    if (!isPlayerTurn || isGameOver) { return; }
                    var index = $(this).index(),
                        i = index / 15 | 0,
                        j = index % 15;
                    if (i === 0 && j === 0) {
                        $(this).removeClass("hover-up-left");
                    }
                    else if (i === 0 && j === 14) {
                        $(this).removeClass("hover-up-right");
                    }
                    else if (i === 14 && j === 0) {
                        $(this).removeClass("hover-down-left");
                    }
                    else if (i === 14 && j === 14) {
                        $(this).removeClass("hover-down-right");
                    }
                    else if (i === 0) {
                        $(this).removeClass("hover-up");
                    }
                    else if (i === 14) {
                        $(this).removeClass("hover-down");
                    }
                    else if (j === 0) {
                        $(this).removeClass("hover-left");
                    }
                    else if (j === 14) {
                        $(this).removeClass("hover-right");
                    }
                    else {
                        $(this).removeClass("hover");
                    }
                }
            )
        };

        var gameStart = function () {
            totalGames++;
            //AI先手
            if (!isPlayerTurn && isPlayWithAI) {
                AImoveChess();
            }

            isGameStart = true;
            $(".operating-panel p a").addClass("disable");
            $("#replay_btn").html("重&nbsp;&nbsp;&nbsp;玩");
        };

        var gameOver = function () {
            isGameStart = false;
            $(".operating-panel a").removeClass("disable");
            $("#replay_btn").html("开&nbsp;&nbsp;&nbsp;始");
        };

        //下棋 i行，j列，color颜色
        var playChess = function (i, j, color) {
            chessArr[i][j] = color === LEFT ? BLACK_CHESS : WHITE_CHESS;
            if (color === AIPlayer && isPlayWithAI) {
                $("div.chessboard div." + color + "-last").addClass(color).removeClass(color + "-last");
                $("div.chessboard div:eq(" + (i * 15 + j) + ")").addClass(color + "-last");
            }
            else {
                $("div.chessboard div:eq(" + (i * 15 + j) + ")").addClass(color);
            }
        };

        var playerWinOrNot = function (i, j) {
            var nums = 1,	//连续棋子个数
                chessColor = humanPlayer === LEFT ? BLACK_CHESS : WHITE_CHESS,
                m, n;
            //x方向
            for (m = j - 1; m >= 0; m--) {
                if (chessArr[i][m] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = j + 1; m < 15; m++) {
                if (chessArr[i][m] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                playerWin();
                return;
            }
            else {
                nums = 1;
            }
            //y方向
            for (m = i - 1; m >= 0; m--) {
                if (chessArr[m][j] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1; m < 15; m++) {
                if (chessArr[m][j] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                playerWin();
                return;
            }
            else {
                nums = 1;
            }
            //左斜方向
            for (m = i - 1, n = j - 1; m >= 0 && n >= 0; m--, n--) {
                if (chessArr[m][n] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1, n = j + 1; m < 15 && n < 15; m++, n++) {
                if (chessArr[m][n] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                playerWin();
                return;
            }
            else {
                nums = 1;
            }
            //右斜方向
            for (m = i - 1, n = j + 1; m >= 0 && n < 15; m--, n++) {
                if (chessArr[m][n] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1, n = j - 1; m < 15 && n >= 0; m++, n--) {
                if (chessArr[m][n] === chessColor) {
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                playerWin();
                return;
            }
            isPlayWithAI && AImoveChess();
        };

        var playerWin = function () {
            winGames++;
            showResult(true);
            gameOver();
        };

        var showResult = function(isPlayerWin) {
            if (isPlayerWin) {
                $("#result_tips").html("恭喜"+humanPlayer+"获胜！");
            }
            else {
                $("#result_tips").html("哈哈，你输咯！");
            }
            isGameOver = true;
            showWinChesses(isPlayerWin);
        };

        //标记显示获胜棋子
        var showWinChesses = function (isPlayerWin) {
            var nums = 1,	//连续棋子个数
                lineChess = [],	//连续棋子位置
                i,
                j,
                chessColor,
                m, n;
            if (isPlayerWin) {
                chessColor = humanPlayer == LEFT? BLACK_CHESS : WHITE_CHESS;
                i = playerLastChess[0];
                j = playerLastChess[1];
            }
            else {
                chessColor = AIPlayer === LEFT? BLACK_CHESS : WHITE_CHESS;
                i = AILastChess[0];
                j = AILastChess[1];
            }
            $("div.chessboard div." + AIPlayer + "-last").addClass(AIPlayer).removeClass(AIPlayer + "-last");
            //x方向
            lineChess[0] = [i];
            lineChess[1] = [j];
            for (m = j - 1; m >= 0; m--) {
                if (chessArr[i][m] === chessColor) {
                    lineChess[0][nums] = i;
                    lineChess[1][nums] = m;
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = j + 1; m < 15; m++) {
                if (chessArr[i][m] === chessColor) {
                    lineChess[0][nums] = i;
                    lineChess[1][nums] = m;
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                for (k = nums - 1; k >= 0; k--) {
                    markChess(lineChess[0][k] * 15 + lineChess[1][k], isPlayerWin ? humanPlayer : AIPlayer);
                }
                return;
            }
            //y方向
            nums = 1;
            lineChess[0] = [i];
            lineChess[1] = [j];
            for (m = i - 1; m >= 0; m--) {
                if (chessArr[m][j] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = j;
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1; m < 15; m++) {
                if (chessArr[m][j] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = j;
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                for (k = nums - 1; k >= 0; k--) {
                    markChess(lineChess[0][k] * 15 + lineChess[1][k], isPlayerWin ? humanPlayer : AIPlayer);
                }
                return;
            }
            //左斜方向
            nums = 1;
            lineChess[0] = [i];
            lineChess[1] = [j];
            for (m = i - 1, n = j - 1; m >= 0 && n >= 0; m--, n--) {
                if (chessArr[m][n] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = n;
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1, n = j + 1; m < 15 && n < 15; m++, n++) {
                if (chessArr[m][n] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = n;
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                for (k = nums - 1; k >= 0; k--) {
                    markChess(lineChess[0][k] * 15 + lineChess[1][k], isPlayerWin ? humanPlayer : AIPlayer);
                }
                return;
            }
            //右斜方向
            nums = 1;
            lineChess[0] = [i];
            lineChess[1] = [j];
            for (m = i - 1, n = j + 1; m >= 0 && n < 15; m--, n++) {
                if (chessArr[m][n] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = n;
                    nums++;
                }
                else {
                    break;
                }
            }
            for (m = i + 1, n = j - 1; m < 15 && n >= 0; m++, n--) {
                if (chessArr[m][n] === chessColor) {
                    lineChess[0][nums] = m;
                    lineChess[1][nums] = n;
                    nums++;
                }
                else {
                    break;
                }
            }
            if (nums >= 5) {
                for (k = nums - 1; k >= 0; k--) {
                    markChess(lineChess[0][k] * 15 + lineChess[1][k], isPlayerWin ? humanPlayer : AIPlayer);
                }
            }
        };

        var markChess = function (pos, color) {
            $("div.chessboard div:eq(" + pos + ")").removeClass(color).addClass(color + "-last");
        };

        return {
            init: function() {
                chessBoardHtml = $("div.chessboard").html();

                var menu_Command = function (receiver) {
                    return function(){
                        receiver.execute()
                    }
                };
                var black_btn = {
                    execute: function(){
                        humanPlayer = "black";
                    }
                };
                var white_btn = {
                    execute: function(){
                        humanPlayer = "white";
                    }
                };
                var first_move_btn = {
                    execute: function(){
                        isPlayerTurn = true;
                    }
                };
                var second_move_btn = {
                    execute: function(){
                        isPlayerTurn = false;
                    }
                };
                var replay_btn = {
                    execute: function(){
                        resetChessBoard();
                        if (isGameStart) {	//点重玩
                            gameOver();
                        }
                        else {	//点开始
                            gameStart();
                        }
                    }
                };
                //右侧操作按钮
                $(".operating-panel a").click(function (event) {
                    event.preventDefault();
                    var id = $(this).attr("id");
                    if (isGameStart && id !== "replay_btn" ) { return; }	//正在游戏 不操作
                    menu_Command(id)();
                    if (id !== "replay_btn") {
                        $(this).addClass("selected").siblings().removeClass("selected");
                    }
                });

                resetChessBoard();
            }
        }
    })()
</script>